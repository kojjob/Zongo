<div class="bg-gradient-to-b from-primary-50 to-gray-50 dark:from-gray-900 dark:to-gray-950 min-h-screen"
     data-controller="receive-money"
     data-receive-money-account-name="<%= current_user.full_name %>"
     data-receive-money-account-number="<%= @wallet.wallet_id %>"
     data-receive-money-bank-name="Super Ghana Bank"
     data-receive-money-payment-link="<%= @payment_link %>">

  <!-- Toast Notification for Copy Actions -->
  <div data-receive-money-target="toast" class="fixed top-24 inset-x-0 z-50 hidden">
    <div class="max-w-sm mx-auto bg-gray-800 text-white px-4 py-3 rounded-xl shadow-lg flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-400 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <span data-receive-money-target="toastMessage">Copied to clipboard!</span>
    </div>
  </div>

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header with Subtle Gradient Background -->
    <div class="mb-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5 border border-gray-100 dark:border-gray-700 relative overflow-hidden">
      <!-- Subtle background pattern -->
      <div class="absolute right-0 top-0 w-64 h-64 bg-primary-50/50 dark:bg-primary-900/5 rounded-full -mr-32 -mt-32 opacity-70"></div>
      <div class="absolute left-0 bottom-0 w-48 h-48 bg-primary-50/30 dark:bg-primary-900/5 rounded-full -ml-24 -mb-24 opacity-50"></div>

      <div class="relative">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-2">
          <div class="flex items-center">
            <a href="<%= wallet_path %>" class="flex items-center justify-center w-10 h-10 rounded-full bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors mr-3 shadow-sm border border-gray-100 dark:border-gray-700">
              <%= icon "arrow-left", class: "w-5 h-5" %>
            </a>
            <div>
              <h1 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white">Receive Money</h1>
              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                Share your payment details with anyone to receive money directly into your account.
              </p>
            </div>
          </div>

          <div class="self-start sm:self-center flex items-center bg-primary-50 dark:bg-primary-900/10 rounded-lg px-4 py-2 border border-primary-100 dark:border-primary-800/30">
            <span class="mr-2 text-gray-600 dark:text-gray-400 text-sm">Balance:</span>
            <span class="font-bold text-gray-900 dark:text-white"><%= @wallet.currency_symbol %><%= number_with_delimiter(@wallet.balance, delimiter: ',') %></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden">
      <!-- Tab Navigation using Universal Tab Controller -->
      <div data-controller="universal-tab" data-universal-tab-sync-hash-value="true" data-universal-tab-persist-value="true" data-universal-tab-style-value="pills" data-universal-tab-default-tab-value="<%= @active_tab || 'account_details' %>">
        <div class="bg-gray-50 dark:bg-gray-800 p-3 border-b border-gray-200 dark:border-gray-700" data-universal-tab-target="tabsList">
          <div class="grid grid-cols-3 gap-2">
            <button
              data-universal-tab-target="tab"
              data-action="universal-tab#select"
              data-tab-id="account_details"
              class="w-full py-3 px-2 rounded-xl flex flex-col items-center justify-center transition-all duration-200 bg-white dark:bg-gray-700 text-primary-600 dark:text-primary-400 shadow">
              <div class="w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-600 dark:text-primary-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                  <line x1="2" y1="10" x2="22" y2="10"></line>
                </svg>
              </div>
              <span class="text-sm font-medium">Account Details</span>
            </button>

            <button
              data-universal-tab-target="tab"
              data-action="universal-tab#select"
              data-tab-id="qr_code"
              class="w-full py-3 px-2 rounded-xl flex flex-col items-center justify-center transition-all duration-200 bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50">
              <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </div>
              <span class="text-sm font-medium">QR Code</span>
            </button>

            <button
              data-universal-tab-target="tab"
              data-action="universal-tab#select"
              data-tab-id="payment_link"
              class="w-full py-3 px-2 rounded-xl flex flex-col items-center justify-center transition-all duration-200 bg-transparent text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50">
              <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                </svg>
              </div>
              <span class="text-sm font-medium">Payment Link</span>
            </button>
          </div>
        </div>

        <!-- Tab Panels -->
        <div>
          <!-- Account Details Tab Panel -->
          <div data-universal-tab-target="panel" data-tab-id="account_details" class="p-0">
            <div class="p-6">
              <!-- Account Card -->
              <div class="relative bg-gradient-to-r from-primary-600 to-primary-800 dark:from-primary-700 dark:to-primary-900 rounded-xl p-6 shadow-lg overflow-hidden mb-6">
                <!-- Decorative circles -->
                <div class="absolute top-0 right-0 w-40 h-40 rounded-full bg-white opacity-5"></div>
                <div class="absolute bottom-0 left-0 w-40 h-40 rounded-full bg-white opacity-5"></div>

                <!-- Card content -->
                <div class="relative z-10">
                  <!-- Card header -->
                  <div class="flex justify-between items-start mb-6">
                    <div>
                      <h3 class="text-xl font-bold text-white">Super Ghana Bank</h3>
                      <p class="text-primary-100">Your Account Details</p>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-white">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                        <line x1="2" y1="10" x2="22" y2="10"></line>
                      </svg>
                    </div>
                  </div>

                  <!-- Account details -->
                  <div class="space-y-4">
                    <!-- Account Number with visual emphasis -->
                    <div class="mb-6">
                      <label class="block text-xs font-medium text-primary-100 mb-1">Account Number</label>
                      <div class="flex items-center justify-between">
                        <p class="text-white font-mono text-2xl tracking-wider font-bold">
                          <% formatted_id = @wallet.wallet_id.to_s.scan(/.{1,4}/).join(' ') %>
                          <%= formatted_id %>
                        </p>
                        <button type="button" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg transition-colors"
                                data-action="receive-money#copyToClipboard"
                                data-copy-text="<%= @wallet.wallet_id %>">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                          </svg>
                        </button>
                      </div>
                    </div>

                    <!-- Account Name -->
                    <div>
                      <label class="block text-xs font-medium text-primary-100 mb-1">Account Name</label>
                      <div class="flex items-center justify-between">
                        <p class="text-white font-medium"><%= current_user.full_name %></p>
                        <button type="button" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg transition-colors"
                                data-action="receive-money#copyToClipboard"
                                data-copy-text="<%= current_user.full_name %>">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                          </svg>
                        </button>
                      </div>
                    </div>

                    <!-- Bank Name -->
                    <div>
                      <label class="block text-xs font-medium text-primary-100 mb-1">Bank Name</label>
                      <div class="flex items-center justify-between">
                        <p class="text-white font-medium">Super Ghana Bank</p>
                        <button type="button" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg transition-colors"
                                data-action="receive-money#copyToClipboard"
                                data-copy-text="Super Ghana Bank">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Share Options -->
              <div class="bg-gray-50 dark:bg-gray-700/30 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary-500 dark:text-primary-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                  </svg>
                  Share Account Details
                </h3>

                <div class="grid grid-cols-3 gap-4">
                  <button type="button" data-action="receive-money#shareViaWhatsApp"
                          class="flex flex-col items-center justify-center space-y-2 bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"></path>
                      <path d="M9 10a0.5 .5 0 0 0 1 0V9a0.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a0.5 .5 0 0 0 0 -1h-1a0.5 .5 0 0 0 0 1"></path>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-sm font-medium">WhatsApp</span>
                  </button>

                  <button type="button" data-action="receive-money#shareViaSMS"
                          class="flex flex-col items-center justify-center space-y-2 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 dark:text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-sm font-medium">SMS</span>
                  </button>

                  <button type="button" data-action="receive-money#shareViaEmail"
                          class="flex flex-col items-center justify-center space-y-2 bg-purple-50 dark:bg-purple-900/20 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-600 dark:text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                      <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-sm font-medium">Email</span>
                  </button>
                </div>

                <div class="mt-4 grid grid-cols-2 gap-4">
                  <button data-universal-tab-target="tab" data-action="universal-tab#select" data-tab-id="qr_code"
                          class="flex items-center justify-center py-3 px-4 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="3" width="7" height="7"></rect>
                      <rect x="14" y="3" width="7" height="7"></rect>
                      <rect x="14" y="14" width="7" height="7"></rect>
                      <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Show QR Code
                  </button>

                  <button data-universal-tab-target="tab" data-action="universal-tab#select" data-tab-id="payment_link"
                          class="flex items-center justify-center py-3 px-4 bg-secondary-600 hover:bg-secondary-700 text-white font-medium rounded-lg transition-colors shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    Show Payment Link
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- QR Code Tab Panel -->
          <div data-universal-tab-target="panel" data-tab-id="qr_code" class="p-0">
            <div class="p-6">
              <!-- QR Code Card -->
              <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-primary-600 to-primary-800 dark:from-primary-700 dark:to-primary-900 p-6">
                  <div class="flex justify-between items-center">
                    <div>
                      <h3 class="text-xl font-bold text-white">Your QR Code</h3>
                      <p class="text-primary-100">Let others scan to pay you instantly</p>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                      </svg>
                    </div>
                  </div>
                </div>

                <!-- QR Code Display -->
                <div class="flex flex-col items-center justify-center p-8 bg-gray-50 dark:bg-gray-900/30">
                  <!-- QR Code with decorative frame -->
                  <div class="relative">
                    <!-- Decorative corners -->
                    <div class="absolute -top-3 -left-3 w-6 h-6 border-t-2 border-l-2 border-primary-500 dark:border-primary-400"></div>
                    <div class="absolute -top-3 -right-3 w-6 h-6 border-t-2 border-r-2 border-primary-500 dark:border-primary-400"></div>
                    <div class="absolute -bottom-3 -left-3 w-6 h-6 border-b-2 border-l-2 border-primary-500 dark:border-primary-400"></div>
                    <div class="absolute -bottom-3 -right-3 w-6 h-6 border-b-2 border-r-2 border-primary-500 dark:border-primary-400"></div>

                    <!-- QR Code -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 qr-code-container">
                      <% begin %>
                        <% if params[:amount].present? %>
                          <!-- QR code with amount -->
                          <div class="mb-3 text-center">
                            <div class="inline-flex items-center px-3 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-sm font-medium">
                              <span class="mr-1"><%= @wallet.currency_symbol %><%= params[:amount] %></span>
                              <%= icon "check-circle", class: "w-4 h-4" %>
                            </div>
                            <% if params[:purpose].present? %>
                              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><%= params[:purpose] %></p>
                            <% end %>
                          </div>
                        <% end %>

                        <%= qr_code_as_svg(@qr_code_data, size: 10, module_size: 6) %>

                        <!-- QR Code Scan Instructions -->
                        <div class="mt-3 flex items-center justify-center text-xs text-gray-500 dark:text-gray-400">
                          <%= icon "smartphone", class: "w-3 h-3 mr-1" %>
                          <span>Scan with any mobile banking app</span>
                        </div>
                      <% rescue => e %>
                        <!-- Fallback QR code -->
                        <div class="text-center">
                          <p class="text-red-500 dark:text-red-400 mb-2">Error generating QR code</p>
                          <% simple_data = @payment_link.to_s.truncate(50) %>
                          <%= qr_code_as_svg(simple_data, size: 5, module_size: 8) rescue "<p class='text-red-500'>Could not generate QR code</p>".html_safe %>
                        </div>
                      <% end %>
                    </div>
                  </div>

                  <!-- Account info below QR -->
                  <div class="mt-6 text-center">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Scan to send money to</p>
                    <p class="text-lg font-semibold text-gray-900 dark:text-white"><%= current_user.full_name %></p>
                    <p class="text-sm text-gray-500 dark:text-gray-500">Account: <%= @wallet.wallet_id %></p>
                  </div>
                </div>
              </div>

              <!-- Download and Share Options -->
              <div class="bg-gray-50 dark:bg-gray-700/30 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-primary-500 dark:text-primary-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                  </svg>
                  Save & Share QR Code
                </h3>

                <div class="grid grid-cols-2 gap-4">
                  <button type="button" data-action="receive-money#downloadQRCode"
                          class="flex flex-col items-center justify-center space-y-2 bg-primary-50 dark:bg-primary-900/20 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors rounded-xl p-6 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-primary-600 dark:text-primary-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-sm font-medium">Download QR</span>
                  </button>

                  <button type="button" data-action="receive-money#shareQRCode"
                          class="flex flex-col items-center justify-center space-y-2 bg-secondary-50 dark:bg-secondary-900/20 hover:bg-secondary-100 dark:hover:bg-secondary-900/30 transition-colors rounded-xl p-6 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-secondary-600 dark:text-secondary-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="18" cy="5" r="3"></circle>
                      <circle cx="6" cy="12" r="3"></circle>
                      <circle cx="18" cy="19" r="3"></circle>
                      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-sm font-medium">Share QR</span>
                  </button>
                </div>

                <!-- Request Specific Amount Section -->
                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                  <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-4">Request Specific Amount</h3>

                  <div class="space-y-4">
                    <div>
                      <label for="requested_amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount (<%= @wallet.currency %>)</label>
                      <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                          <span class="text-gray-500 dark:text-gray-400"><%= @wallet.currency_symbol %></span>
                        </div>
                        <input type="number" id="requested_amount" class="block w-full pl-8 pr-4 py-3 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="0.00" min="1" step="0.01" data-receive-money-target="requestAmount">
                      </div>
                    </div>

                    <div>
                      <label for="payment_purpose" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Purpose (Optional)</label>
                      <input type="text" id="payment_purpose" class="block w-full px-4 py-3 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="What's this payment for?" data-receive-money-target="requestPurpose">
                    </div>

                    <button type="button" data-action="receive-money#generateAmountQR" class="w-full py-3 px-4 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                      Generate QR Code with Amount
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Link Tab Panel -->
          <div data-universal-tab-target="panel" data-tab-id="payment_link" class="p-0">
            <div class="p-6">
              <!-- Payment Link Card -->
              <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-secondary-600 to-secondary-800 dark:from-secondary-700 dark:to-secondary-900 p-6">
                  <div class="flex justify-between items-center">
                    <div>
                      <h3 class="text-xl font-bold text-white">Your Payment Link</h3>
                      <p class="text-secondary-100">Share this link for easy payments</p>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-white">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                      </svg>
                    </div>
                  </div>
                </div>

                <!-- Payment Link Display -->
                <div class="p-6 bg-gray-50 dark:bg-gray-900/30">
                  <!-- Link with copy button -->
                  <div class="flex items-stretch">
                    <div class="flex-grow bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-l-lg px-4 py-3 overflow-x-auto whitespace-nowrap text-gray-700 dark:text-gray-300 font-mono">
                      <%= @payment_link %>
                    </div>
                    <button type="button" class="bg-primary-600 hover:bg-primary-700 text-white px-4 rounded-r-lg flex items-center justify-center transition-colors"
                            data-action="receive-money#copyToClipboard"
                            data-copy-text="<%= @payment_link %>">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                      </svg>
                    </button>
                  </div>

                  <!-- QR Code for the link -->
                  <div class="mt-6 flex justify-center">
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 inline-block">
                      <% begin %>
                        <%= qr_code_as_svg(@payment_link, size: 5, module_size: 4) %>
                      <% rescue => e %>
                        <p class="text-red-500 dark:text-red-400 text-xs">Could not generate QR code</p>
                      <% end %>
                    </div>
                  </div>

                  <!-- Link status and info -->
                  <div class="mt-6">
                    <% if params[:link_id].present? %>
                      <!-- Custom link info -->
                      <div class="bg-green-50 dark:bg-green-900/10 border border-green-100 dark:border-green-800/30 rounded-lg p-4 mb-4">
                        <div class="flex items-start">
                          <div class="flex-shrink-0">
                            <%= icon "check-circle", class: "h-5 w-5 text-green-500" %>
                          </div>
                          <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800 dark:text-green-300">Custom payment link created!</h3>
                            <div class="mt-2 text-sm text-green-700 dark:text-green-400">
                              <p>Your link has been created and is ready to share.</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    <% end %>

                    <!-- Link information -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                      <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Link Information</h4>

                      <div class="space-y-3">
                        <div class="flex justify-between items-center">
                          <span class="text-sm text-gray-600 dark:text-gray-400">Status</span>
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300">
                            Active
                          </span>
                        </div>

                        <div class="flex justify-between items-center">
                          <span class="text-sm text-gray-600 dark:text-gray-400">Created</span>
                          <span class="text-sm text-gray-900 dark:text-gray-300"><%= Time.now.strftime("%b %d, %Y") %></span>
                        </div>

                        <div class="flex justify-between items-center">
                          <span class="text-sm text-gray-600 dark:text-gray-400">Expiry</span>
                          <span class="text-sm text-gray-900 dark:text-gray-300">Never</span>
                        </div>

                        <div class="flex justify-between items-center">
                          <span class="text-sm text-gray-600 dark:text-gray-400">Usage</span>
                          <span class="text-sm text-gray-900 dark:text-gray-300">Unlimited</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Security warning -->
                  <div class="mt-6 flex items-center justify-center">
                    <div class="w-8 h-8 rounded-full bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400 flex items-center justify-center mr-2">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                      </svg>
                    </div>
                    <p class="text-sm text-yellow-700 dark:text-yellow-500">Never share this link with untrusted sources</p>
                  </div>
                </div>
              </div>

              <!-- Custom Payment Link Generator -->
              <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden mb-6">
                <div class="p-6">
                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Create Custom Payment Link</h3>

                  <div class="space-y-4">
                    <div>
                      <label for="payment_amount" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount (<%= @wallet.currency %>)</label>
                      <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                          <span class="text-gray-500 dark:text-gray-400"><%= @wallet.currency_symbol %></span>
                        </div>
                        <input type="number" id="payment_amount" class="block w-full pl-8 pr-4 py-3 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="0.00" min="1" step="0.01" data-receive-money-target="linkAmount">
                      </div>
                    </div>

                    <div>
                      <label for="link_purpose" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Purpose (Optional)</label>
                      <input type="text" id="link_purpose" class="block w-full px-4 py-3 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="What's this payment for?" data-receive-money-target="linkPurpose">
                    </div>

                    <div>
                      <label for="link_expiry" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Link Expiry</label>
                      <select id="link_expiry" class="block w-full px-4 py-3 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-primary-500 focus:border-primary-500" data-receive-money-target="linkExpiry">
                        <option value="never">Never expires</option>
                        <option value="24h">24 hours</option>
                        <option value="7d">7 days</option>
                        <option value="30d">30 days</option>
                      </select>
                    </div>

                    <button type="button" data-action="receive-money#generateCustomLink" class="w-full py-3 px-4 bg-secondary-600 hover:bg-secondary-700 text-white font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-secondary-500 focus:ring-offset-2">
                      Generate Custom Payment Link
                    </button>
                  </div>
                </div>
              </div>

              <!-- Share Link Options -->
              <div class="bg-gray-50 dark:bg-gray-700/30 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-secondary-500 dark:text-secondary-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                  </svg>
                  Share Payment Link
                </h3>

                <div class="grid grid-cols-4 gap-4">
                  <button type="button" data-action="receive-money#shareViaWhatsApp" data-share-type="link"
                          class="flex flex-col items-center justify-center space-y-2 bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"></path>
                      <path d="M9 10a0.5 .5 0 0 0 1 0V9a0.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a0.5 .5 0 0 0 0 -1h-1a0.5 .5 0 0 0 0 1"></path>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-xs font-medium">WhatsApp</span>
                  </button>

                  <button type="button" data-action="receive-money#shareViaSMS" data-share-type="link"
                          class="flex flex-col items-center justify-center space-y-2 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 dark:text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-xs font-medium">SMS</span>
                  </button>

                  <button type="button" data-action="receive-money#shareViaEmail" data-share-type="link"
                          class="flex flex-col items-center justify-center space-y-2 bg-purple-50 dark:bg-purple-900/20 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-600 dark:text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                      <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-xs font-medium">Email</span>
                  </button>

                  <button type="button" data-action="receive-money#shareViaOther" data-share-type="link"
                          class="flex flex-col items-center justify-center space-y-2 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors rounded-xl p-4 shadow-sm hover:shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-600 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="18" cy="5" r="3"></circle>
                      <circle cx="6" cy="12" r="3"></circle>
                      <circle cx="18" cy="19" r="3"></circle>
                      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    <span class="text-gray-700 dark:text-gray-300 text-xs font-medium">More</span>
                  </button>
                </div>
              </div>

              <!-- Payment Link History -->
              <div class="mt-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                  <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Payment Links</h3>
                </div>
                <div class="divide-y divide-gray-200 dark:divide-gray-700">
                  <% if @recent_payment_links.present? %>
                    <% @recent_payment_links.each do |link| %>
                      <div class="p-4 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors">
                        <div class="flex items-center justify-between">
                          <div>
                            <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">
                              <%= link.purpose.present? ? link.purpose : "Payment" %>
                              <% if link.amount.present? %>
                                - <%= @wallet.currency_symbol %><%= number_with_delimiter(link.amount, delimiter: ',') %>
                              <% end %>
                            </p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">
                              Created: <%= link.created_at.strftime("%b %d, %Y") %>
                              <% if link.expires_at.present? %>
                                â€¢ Expires: <%= link.expires_at.strftime("%b %d, %Y") %>
                              <% end %>
                            </p>
                          </div>
                          <div class="flex items-center">
                            <button type="button" class="text-gray-500 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 p-2"
                                    data-action="receive-money#copyToClipboard"
                                    data-copy-text="<%= link.url %>">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                              </svg>
                            </button>
                            <button type="button" class="text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 p-2"
                                    data-action="receive-money#deletePaymentLink"
                                    data-link-id="<%= link.id %>">
                              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                              </svg>
                            </button>
                          </div>
                        </div>
                      </div>
                    <% end %>
                  <% else %>
                    <div class="p-6 text-center">
                      <div class="w-16 h-16 mx-auto rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                          <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                      </div>
                      <p class="text-gray-600 dark:text-gray-400 mb-4">You haven't created any payment links yet</p>
                      <button type="button" data-action="receive-money#focusCustomLink" class="py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                        Create Your First Link
                      </button>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Help and Support Section -->
    <div class="mt-8 bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <div class="w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-600 dark:text-primary-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </div>
        </div>
        <div class="ml-4 flex-1">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Need Help?</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
            If you're experiencing issues with receiving payments or have questions about the process, our support team is here to help.
          </p>
          <a href="<%= support_path %>" class="inline-flex items-center text-sm font-medium text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300">
            Contact Support
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :page_helpers do %>
  <script>
    // This is where JavaScript for the receive-money controller would go
    document.addEventListener('DOMContentLoaded', function() {
      // JavaScript to support the controller's functions
    });
  </script>
<% end %>

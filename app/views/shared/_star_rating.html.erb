<%
# This partial renders a star rating display
# Parameters:
# - rating: The rating value (float between 0 and 5)
# - max_rating: The maximum rating value (default: 5)
# - size: The size of the stars (default: 5, options: 4, 5, 6)
# - show_number: Whether to show the numeric rating (default: false)
# - reviews_count: The number of reviews (optional)

max_rating = local_assigns.fetch(:max_rating, 5)
size = local_assigns.fetch(:size, 5)
show_number = local_assigns.fetch(:show_number, false)
reviews_count = local_assigns[:reviews_count]

# Determine star size class
star_size_class = case size
                  when 4
                    "h-4 w-4"
                  when 6
                    "h-6 w-6"
                  else
                    "h-5 w-5"
                  end
%>

<div class="flex items-center">
  <div class="flex">
    <% max_rating.times do |i| %>
      <% if rating >= i + 1 %>
        <%# Full star %>
        <svg xmlns="http://www.w3.org/2000/svg" class="<%= star_size_class %> text-yellow-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
      <% elsif rating > i %>
        <%# Partial star (half) %>
        <svg xmlns="http://www.w3.org/2000/svg" class="<%= star_size_class %> text-yellow-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <defs>
            <linearGradient id="half-fill-<%= i %>" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="<%= (rating - i) * 100 %>%" stop-color="currentColor" />
              <stop offset="<%= (rating - i) * 100 %>%" stop-color="#D1D5DB" />
            </linearGradient>
          </defs>
          <path fill="url(#half-fill-<%= i %>)" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
      <% else %>
        <%# Empty star %>
        <svg xmlns="http://www.w3.org/2000/svg" class="<%= star_size_class %> text-gray-300 dark:text-gray-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
      <% end %>
    <% end %>
  </div>
  
  <% if show_number || reviews_count %>
    <div class="ml-2 flex items-center text-sm text-gray-500 dark:text-gray-400">
      <% if show_number %>
        <span class="font-medium"><%= rating.round(1) %></span>
      <% end %>
      
      <% if show_number && reviews_count %>
        <span class="mx-1">&middot;</span>
      <% end %>
      
      <% if reviews_count %>
        <span><%= reviews_count %> <%= "review".pluralize(reviews_count) %></span>
      <% end %>
    </div>
  <% end %>
</div>

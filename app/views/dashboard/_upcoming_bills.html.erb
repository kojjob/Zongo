<%# Upcoming Bills Widget %>
<div class="mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700 reveal-on-scroll" data-animation-target="reveal">
  <!-- Enhanced header with gradient and improved layout -->
  <div class="bg-gradient-to-r from-rose-600 to-pink-600 p-6 text-white">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center mr-4 shadow-md">
          <%= icon "calendar-clock", class: "w-6 h-6" %>
        </div>
        <div>
          <h2 class="text-2xl font-bold">Upcoming Bills</h2>
          <p class="text-white/80 text-sm mt-1">Your scheduled payments for the next 30 days</p>
        </div>
      </div>
      <a href="<%= scheduled_transactions_path %>" class="bg-white/10 hover:bg-white/20 px-5 py-2.5 rounded-xl text-sm font-medium flex items-center transition-all duration-300 backdrop-blur-sm shadow-sm hover:shadow-md transform hover:-translate-y-0.5">
        <span>Manage Bills</span>
        <%= icon "settings", class: "w-4 h-4 ml-2" %>
      </a>
    </div>
  </div>

  <div class="p-6">
    <% if @upcoming_bills.present? && @upcoming_bills.any? %>
      <!-- Bills summary stats -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <!-- Total upcoming amount -->
        <div class="bg-gradient-to-br from-rose-50 to-pink-50 dark:from-rose-900/10 dark:to-pink-900/10 rounded-xl p-4 border border-rose-200 dark:border-rose-800/30">
          <div class="flex items-center">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-rose-500 to-pink-500 flex items-center justify-center text-white mr-3 shadow-md">
              <%= icon "money-out", class: "w-5 h-5" %>
            </div>
            <div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Total Upcoming</div>
              <div class="text-lg font-bold text-gray-900 dark:text-white"><%= @wallet.currency_symbol %><%= number_with_delimiter(@total_upcoming_amount.round(2)) %></div>
            </div>
          </div>
        </div>

        <!-- Due this week -->
        <div class="bg-gradient-to-br from-amber-50 to-yellow-50 dark:from-amber-900/10 dark:to-yellow-900/10 rounded-xl p-4 border border-amber-200 dark:border-amber-800/30">
          <div class="flex items-center">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-yellow-500 flex items-center justify-center text-white mr-3 shadow-md">
              <%= icon "calendar", class: "w-5 h-5" %>
            </div>
            <div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Due This Week</div>
              <div class="text-lg font-bold text-gray-900 dark:text-white"><%= @bills_due_this_week %> bills</div>
            </div>
          </div>
        </div>

        <!-- Due today -->
        <div class="bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/10 dark:to-rose-900/10 rounded-xl p-4 border border-red-200 dark:border-red-800/30">
          <div class="flex items-center">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-red-500 to-rose-500 flex items-center justify-center text-white mr-3 shadow-md">
              <%= icon "alert-triangle", class: "w-5 h-5" %>
            </div>
            <div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Due Today</div>
              <div class="text-lg font-bold text-gray-900 dark:text-white"><%= @bills_due_today %> bills</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bills timeline -->
      <div class="space-y-4">
        <% @upcoming_bills.each do |bill| %>
          <% 
            # Determine styling based on bill type and urgency
            is_urgent = bill.next_occurrence <= Date.today.end_of_day
            is_soon = bill.next_occurrence <= 3.days.from_now.end_of_day && !is_urgent
            
            # Set colors based on transaction type
            bg_color = case bill.transaction_type
                      when "withdrawal"
                        is_urgent ? "bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800/30" : 
                          (is_soon ? "bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800/30" : 
                            "bg-rose-50 dark:bg-rose-900/10 border-rose-200 dark:border-rose-800/30")
                      when "transfer"
                        is_urgent ? "bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800/30" : 
                          (is_soon ? "bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800/30" : 
                            "bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800/30")
                      when "payment"
                        is_urgent ? "bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-800/30" : 
                          (is_soon ? "bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800/30" : 
                            "bg-purple-50 dark:bg-purple-900/10 border-purple-200 dark:border-purple-800/30")
                      else
                        "bg-gray-50 dark:bg-gray-900/10 border-gray-200 dark:border-gray-800/30"
                      end
            
            # Set icon based on transaction type
            icon_name = case bill.transaction_type
                       when "withdrawal" then "money-out"
                       when "transfer" then "transfer"
                       when "payment" then "file-invoice"
                       else "credit-card"
                       end
            
            # Set icon color based on transaction type
            icon_color = case bill.transaction_type
                        when "withdrawal" then "from-rose-500 to-pink-500"
                        when "transfer" then "from-blue-500 to-indigo-500"
                        when "payment" then "from-purple-500 to-violet-500"
                        else "from-gray-500 to-slate-500"
                        end
            
            # Set status badge
            status_badge = if is_urgent
                            '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300">Due Today</span>'
                          elsif is_soon
                            '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300">Due Soon</span>'
                          else
                            '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">Upcoming</span>'
                          end
          %>
          
          <div class="group relative <%= bg_color %> rounded-xl p-4 border transition-all duration-300 hover:shadow-md transform hover:-translate-y-0.5">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br <%= icon_color %> flex items-center justify-center text-white mr-4 shadow-md">
                  <%= icon icon_name, class: "w-6 h-6" %>
                </div>
                <div>
                  <div class="flex items-center">
                    <h3 class="text-base font-bold text-gray-900 dark:text-white mr-2"><%= bill.description.present? ? bill.description : bill.transaction_type_description %></h3>
                    <%= status_badge.html_safe %>
                  </div>
                  <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    <%= bill.frequency_description %> â€¢ <%= bill.formatted_amount %>
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                    <%= icon "calendar", class: "w-3.5 h-3.5 mr-1.5" %>
                    <% if bill.next_occurrence.to_date == Date.today %>
                      <span class="text-red-600 dark:text-red-400 font-medium">Today</span>
                    <% elsif bill.next_occurrence.to_date == Date.tomorrow %>
                      <span class="text-amber-600 dark:text-amber-400 font-medium">Tomorrow</span>
                    <% else %>
                      <%= bill.next_occurrence.strftime("%d %b, %Y") %> (<%= distance_of_time_in_words_to_now(bill.next_occurrence) %> from now)
                    <% end %>
                  </div>
                </div>
              </div>
              
              <div class="flex space-x-2">
                <% if bill.active? %>
                  <%= button_to pause_scheduled_transaction_path(bill), method: :post, class: "bg-white/80 hover:bg-white dark:bg-gray-800/80 dark:hover:bg-gray-800 p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-all duration-300 shadow-sm" do %>
                    <%= icon "pause", class: "w-5 h-5" %>
                  <% end %>
                <% end %>
                
                <%= button_to execute_scheduled_transaction_path(bill), method: :post, class: "bg-white/80 hover:bg-white dark:bg-gray-800/80 dark:hover:bg-gray-800 p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-all duration-300 shadow-sm" do %>
                  <%= icon "play", class: "w-5 h-5" %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <!-- View all link -->
      <div class="mt-6 text-center">
        <a href="<%= scheduled_transactions_path %>" class="inline-flex items-center px-6 py-3 rounded-xl bg-gradient-to-r from-rose-50 to-pink-50 dark:from-rose-900/10 dark:to-pink-900/10 border border-rose-200 dark:border-rose-800/30 text-rose-700 dark:text-rose-300 font-medium hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
          View All Scheduled Transactions
          <%= icon "arrow-right", class: "h-4 w-4 ml-2" %>
        </a>
      </div>
    <% else %>
      <!-- Empty state -->
      <div class="p-8 text-center">
        <div class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center mb-5 shadow-inner">
          <%= icon "calendar-clock", class: "w-12 h-12 text-gray-400 dark:text-gray-500" %>
        </div>
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3">No Upcoming Bills</h3>
        <p class="text-gray-500 dark:text-gray-400 mb-6 max-w-md mx-auto">You don't have any scheduled transactions or bills due in the next 30 days.</p>
        <a href="<%= new_scheduled_transaction_path %>" class="inline-flex items-center px-6 py-3 rounded-xl font-bold shadow-lg bg-gradient-to-r from-rose-600 to-pink-600 text-white transition-all duration-300 transform hover:-translate-y-1 hover:shadow-xl">
          <%= icon "plus-circle", class: "w-5 h-5 mr-2" %>
          Schedule a Transaction
        </a>
      </div>
    <% end %>
  </div>
</div>

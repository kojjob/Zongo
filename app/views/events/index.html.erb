<% content_for :title, "Events" %>

<% if notice.present? %>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 mb-6">
    <%= render 'shared/flash_message', message: notice, type: 'success' %>
  </div>
<% end %>

<% unless defined?(current_user) && current_user %>
  <!-- For development: Show a message when not signed in -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-6">
    <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-xl shadow-sm border border-blue-200 dark:border-blue-700">
      <div class="flex items-center space-x-3">
        <div class="flex-shrink-0 text-blue-500 dark:text-blue-400">
          <%= icon "information-circle", class: "w-5 h-5" %>
        </div>
        <div class="flex-1">
          <p class="text-sm text-blue-700 dark:text-blue-300">Sign in to see admin controls. To show admin panel for development, set <code>ENV['SHOW_ADMIN_TO_ALL']='true'</code>.</p>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%# Admin check - modify this condition to match your user roles system %>
<%# For development, you can set SHOW_ADMIN_TO_ALL=true to make admin panel visible to all users %>
<% if defined?(current_user) && (
       current_user.try(:admin?) || 
       current_user.try(:is_admin) || 
       current_user.try(:role) == 'admin' || 
       current_user.try(:admin) == true ||
       ENV['SHOW_ADMIN_TO_ALL'] == 'true' # Remove this in production!
     ) %>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-6">
    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-medium text-gray-900 dark:text-white">
          <% if !(current_user.try(:admin?) || current_user.try(:is_admin) || current_user.try(:role) == 'admin' || current_user.try(:admin) == true) && ENV['SHOW_ADMIN_TO_ALL'] == 'true' %>
            <span class="text-yellow-500 dark:text-yellow-400">[DEV MODE]</span>
          <% end %> 
          Admin Controls
        </h3>
        <button type="button" id="toggleAdminPanel" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
          <%= icon "chevron-down", class: "w-5 h-5" %>
        </button>
      </div>
      
      <div id="adminPanelContent" class="mt-4 hidden">
        <% if defined?(Setting) %>
          <%= form_with url: update_hero_banner_path, method: :patch, multipart: true, class: "space-y-4" do |f| %>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Upload Hero Banner</label>
              <div class="flex items-center space-x-3">
                <%= f.file_field :hero_banner, class: "file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100 dark:file:bg-primary-900 dark:file:text-primary-300 dark:hover:file:bg-primary-800" %>
                <%= f.submit "Update Banner", class: "px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md text-sm font-medium" %>
              </div>
              <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Recommended size: 1600x600px. Max file size: 5MB.</p>
            </div>
            
            <% if defined?(@hero_banner) && @hero_banner.present? %>
              <div class="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-900 rounded-md">
                <div class="flex items-center">
                  <div class="w-16 h-12 bg-cover bg-center rounded mr-3" style="background-image: url('<%= url_for(@hero_banner) %>');"></div>
                  <span class="text-sm text-gray-700 dark:text-gray-300">Current Banner</span>
                </div>
                <%= link_to "Remove", remove_hero_banner_path, method: :delete, class: "text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300", data: { turbo_confirm: "Are you sure you want to remove the current banner?" } %>
              </div>
            <% end %>
          <% end %>
        <% else %>
          <div class="bg-yellow-50 dark:bg-yellow-900 p-3 rounded-md text-yellow-800 dark:text-yellow-200 text-sm">
            <p>The Setting model is not available. Please run <code>rails db:migrate</code> to create the settings table.</p>
          </div>
        <% end %>
      </div>
      
      <script>
        document.getElementById('toggleAdminPanel').addEventListener('click', function() {
          const content = document.getElementById('adminPanelContent');
          content.classList.toggle('hidden');
          this.innerHTML = content.classList.contains('hidden') ? 
            '<%= icon "chevron-down", class: "w-5 h-5" %>' : 
            '<%= icon "chevron-up", class: "w-5 h-5" %>';
        });
      </script>
    </div>
  </div>
<% end %>

  <!-- Hero Section - with user-uploadable banner -->
  <div class="relative mb-24 overflow-hidden w-full">
    <div class="hero-slider relative h-[500px] bg-gradient-to-r from-gray-900 to-primary-900 w-full">
      <!-- Hero Background Image -->
      <div class="absolute inset-0 bg-cover bg-center" 
        <% if defined?(@hero_banner) && @hero_banner.present? %>
          style="background-image: url('<%= url_for(@hero_banner) %>'); opacity: 0.8;"
        <% elsif defined?(@featured_event) && @featured_event&.event_media&.first.present? %>
          style="background-image: url('<%= url_for(@featured_event.event_media.first) %>'); opacity: 0.8;"
        <% elsif File.exist?(Rails.root.join('app/assets/images/default-hero-background.jpg')) %>
          style="background-image: url('<%= asset_path("default-hero-background.jpg") %>'); opacity: 0.7;"
        <% else %>
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); opacity: 0.9;"
        <% end %>
      ></div>
      
      <div class="relative z-10 flex items-center h-full px-8 md:px-12">
        <div class="max-w-2xl">
          <div class="flex items-center mb-2">
            <div class="h-2 w-12 bg-primary-500 rounded-full mr-3"></div>
            <p class="text-white text-sm font-medium uppercase tracking-wider">Find Your Next Experience</p>
          </div>
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight">
            Discover<br> Amazing<br> Events
          </h1>
          <p class="text-gray-200 mb-8 text-lg max-w-lg">Join thousands of people who've found their perfect event. From workshops to concerts, conferences to meetups - your next adventure awaits.</p>
          <%= link_to new_event_path, class: "btn btn-primary px-8 py-4 text-lg rounded-lg shadow-lg hover:shadow-xl transition-all" do %>
            <%= icon "plus-circle", class: "w-5 h-5 mr-2" %>
            Create Event
          <% end %>
        </div>
      </div>
      
      <!-- Photo credit -->
      <div class="absolute bottom-4 right-8 text-white text-xs opacity-70">
        Photos by Event Photographers
      </div>
      
      <!-- Navigation Arrows -->
      <button class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-black bg-opacity-30 hover:bg-opacity-50 rounded-full flex items-center justify-center text-white transition">
        <%= icon "chevron-left", class: "w-6 h-6" %>
      </button>
      <button class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-black bg-opacity-30 hover:bg-opacity-50 rounded-full flex items-center justify-center text-white transition">
        <%= icon "chevron-right", class: "w-6 h-6" %>
      </button>
    </div>
    
    <!-- Search and Filter Bar - inspired by the mockup -->
    <div class="absolute -bottom-16 left-1/2 transform -translate-x-1/2 w-11/12 max-w-5xl bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 z-10">
      <%= form_with url: events_path, method: :get do |f| %>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
        <!-- Looking for -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Looking for</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <%= icon "search", class: "h-5 w-5 text-gray-400" %>
            </div>
            <%= f.text_field :query, class: "search-field block w-full h-12 pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-primary-500 focus:border-primary-500", placeholder: "Workshops, concerts, etc." %>
          </div>
        </div>
        
        <!-- Where -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Where</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <%= icon "location-marker", class: "h-5 w-5 text-gray-400" %>
            </div>
            <%= f.select :location, ["Any location", "New York", "Los Angeles", "Chicago", "San Francisco"], {}, { class: "search-field block w-full h-12 pl-10 pr-10 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-primary-500 focus:border-primary-500 appearance-none" } %>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <%= icon "chevron-down", class: "h-5 w-5 text-gray-400" %>
            </div>
          </div>
        </div>
        
        <!-- When -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">When</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <%= icon "calendar", class: "h-5 w-5 text-gray-400" %>
            </div>
            <%= f.select :date, ["Any date", "Today", "Tomorrow", "This Weekend", "This Week", "This Month"], {}, { class: "search-field block w-full h-12 pl-10 pr-10 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-primary-500 focus:border-primary-500 appearance-none" } %>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <%= icon "chevron-down", class: "h-5 w-5 text-gray-400" %>
            </div>
          </div>
        </div>
        </div>
      
        <!-- Search Button -->
        <div class="mt-6 flex justify-center sm:justify-end">
          <button type="submit" class="px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-all flex items-center">
            <%= icon "search", class: "h-5 w-5 mr-2" %>
            Find Events
          </button>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Upcoming Events Section -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-36 mb-12">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
      <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-0">Upcoming Events</h2>
      
      <div class="flex space-x-3">
        <div class="filter-dropdown relative" data-controller="dropdown">
          <button data-action="dropdown#toggle" class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg flex items-center">
            <span>Weekdays</span>
            <%= icon "chevron-down", class: "h-4 w-4 ml-2" %>
          </button>
          <div data-dropdown-target="menu" class="dropdown-menu hidden right-0 w-48 mt-1">
            <a href="#" class="dropdown-item">All Days</a>
            <a href="#" class="dropdown-item">Weekdays</a>
            <a href="#" class="dropdown-item">Weekends</a>
          </div>
        </div>
        
        <div class="filter-dropdown relative" data-controller="dropdown">
          <button data-action="dropdown#toggle" class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg flex items-center">
            <span>Event Type</span>
            <%= icon "chevron-down", class: "h-4 w-4 ml-2" %>
          </button>
          <div data-dropdown-target="menu" class="dropdown-menu hidden right-0 w-48 mt-1">
            <a href="#" class="dropdown-item">All Types</a>
            <a href="#" class="dropdown-item">Workshops</a>
            <a href="#" class="dropdown-item">Conferences</a>
            <a href="#" class="dropdown-item">Meetups</a>
            <a href="#" class="dropdown-item">Concerts</a>
          </div>
        </div>
        
        <div class="filter-dropdown relative" data-controller="dropdown">
          <button data-action="dropdown#toggle" class="px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg flex items-center">
            <span>Any Category</span>
            <%= icon "chevron-down", class: "h-4 w-4 ml-2" %>
          </button>
          <div data-dropdown-target="menu" class="dropdown-menu hidden right-0 w-48 mt-1">
            <a href="#" class="dropdown-item">All Categories</a>
            <!-- Loop through categories here -->
          </div>
        </div>
      </div>
    </div>
  
    <!-- Events Grid - inspired by the mockup -->
    <div id="events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% if @events.any? %>
        <% @events.each do |event| %>
          <%= render partial: 'event_card', locals: { event: event } %>
        <% end %>
      <% else %>
        <div class="col-span-3 bg-white dark:bg-gray-800 rounded-xl p-8 text-center shadow-md">
          <div class="flex flex-col items-center justify-center">
            <%= icon "calendar-x", class: "w-16 h-16 mb-4 text-gray-300 dark:text-gray-600" %>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No events found</h3>
            <p class="text-gray-500 dark:text-gray-400 mb-6">Start by creating your first event</p>
            <%= link_to new_event_path, class: "btn btn-primary" do %>
              <%= icon "plus-circle", class: "w-5 h-5 mr-2" %>
              Create Event
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    
    <!-- Pagination -->
    <% if @events.any? %>
      <div class="mt-10 flex justify-center">
        <nav class="flex items-center space-x-2">
          <a href="#" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600">
            <%= icon "chevron-left", class: "h-5 w-5" %>
          </a>
          <a href="#" class="px-3 py-1 rounded-md bg-primary-600 text-white">1</a>
          <a href="#" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600">2</a>
          <a href="#" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600">3</a>
          <span class="px-2 text-gray-500">...</span>
          <a href="#" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600">12</a>
          <a href="#" class="px-3 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600">
            <%= icon "chevron-right", class: "h-5 w-5" %>
          </a>
        </nav>
      </div>
    <% end %>
  </div>
</div>

<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Events Management</h1>
    <%= link_to new_admin_event_path, class: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors" do %>
      <i class="fas fa-plus mr-2"></i> New Event
    <% end %>
  </div>

  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Filter Events</h2>
    <%= form_with url: admin_events_path, method: :get, class: "space-y-4" do |f| %>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <%= f.label :status, "Status", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= f.select :status,
              [["All", ""], ["Upcoming", "upcoming"], ["Ongoing", "ongoing"], ["Past", "past"], ["Featured", "featured"]],
              { selected: params[:status] },
              { class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" } %>
        </div>
        <div>
          <%= f.label :organizer_id, "Organizer", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= f.select :organizer_id,
              User.all.map { |u| [u.display_name, u.id] }.unshift(["All", ""]),
              { selected: params[:organizer_id] },
              { class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" } %>
        </div>
        <div>
          <%= f.label :search, "Search", class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
          <%= f.text_field :search, value: params[:search], placeholder: "Search by title or description", class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" %>
        </div>
      </div>
      <div class="flex justify-end">
        <%= f.submit "Filter", class: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors" %>
        <%= link_to "Clear", admin_events_path, class: "ml-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600" %>
      </div>
    <% end %>
  </div>

  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Title</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Organizer</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Attendees</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Featured</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
          <% if @events.any? %>
            <% @events.each do |event| %>
              <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <% if event.banner_image.attached? %>
                      <%= image_tag event.banner_image.variant(resize_to_fill: [40, 40]), class: "h-10 w-10 rounded-full mr-3 object-cover" %>
                    <% else %>
                      <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center mr-3">
                        <i class="fas fa-calendar-alt text-indigo-500"></i>
                      </div>
                    <% end %>
                    <div class="text-sm font-medium text-gray-900 dark:text-white"><%= event.title %></div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900 dark:text-white"><%= event.organizer&.display_name || "Unknown" %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-900 dark:text-white"><%= event.start_time.strftime("%b %d, %Y") %></div>
                  <div class="text-xs text-gray-500 dark:text-gray-400"><%= event.start_time.strftime("%I:%M %p") %> - <%= event.end_time.strftime("%I:%M %p") %></div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <% if event.start_time > Time.current %>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Upcoming</span>
                  <% elsif event.end_time < Time.current %>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Past</span>
                  <% else %>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ongoing</span>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">
                  <%= event.attendances.count %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <% if event.is_featured? %>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">Featured</span>
                  <% else %>
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Not Featured</span>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <div class="flex space-x-2">
                    <%= link_to admin_event_path(event), class: "text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300" do %>
                      <i class="fas fa-eye"></i>
                    <% end %>
                    <%= link_to edit_admin_event_path(event), class: "text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300" do %>
                      <i class="fas fa-edit"></i>
                    <% end %>
                    <%= button_to admin_event_path(event), method: :delete, form: { class: "inline", data: { turbo_confirm: "Are you sure you want to delete this event?" } }, class: "text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 bg-transparent border-0 p-0 cursor-pointer" do %>
                      <i class="fas fa-trash"></i>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                No events found.
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-4">
    <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
  </div>
</div>

<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-center">
      <%= link_to admin_events_path, class: "mr-4 text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" do %>
        <i class="fas fa-arrow-left"></i> Back to Events
      <% end %>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white"><%= @event.title %></h1>
    </div>
    <div class="flex space-x-2">
      <%= link_to edit_admin_event_path(@event), class: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" do %>
        <i class="fas fa-edit mr-2"></i> Edit
      <% end %>
      <%= link_to admin_event_path(@event), method: :delete, data: { confirm: "Are you sure you want to delete this event?" }, class: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors" do %>
        <i class="fas fa-trash mr-2"></i> Delete
      <% end %>
    </div>
  </div>

  <% if notice %>
    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 dark:bg-green-900 dark:text-green-200" role="alert">
      <p><%= notice %></p>
    </div>
  <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Event Banner -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <% if @event.banner_image.attached? %>
          <%= image_tag @event.banner_image, class: "w-full h-64 object-cover" %>
        <% else %>
          <div class="w-full h-64 bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center">
            <i class="fas fa-calendar-alt text-6xl text-indigo-500 dark:text-indigo-400"></i>
          </div>
        <% end %>
      </div>

      <!-- Event Details -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Event Details</h2>
        
        <div class="space-y-4">
          <div>
            <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Description</h3>
            <p class="mt-1 text-gray-900 dark:text-white"><%= @event.description %></p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Start Time</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= @event.start_time.strftime("%B %d, %Y at %I:%M %p") %></p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">End Time</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= @event.end_time.strftime("%B %d, %Y at %I:%M %p") %></p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Location</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= @event.location %></p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Capacity</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= @event.capacity || "Unlimited" %></p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Registration Deadline</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= @event.registration_deadline&.strftime("%B %d, %Y") || "None" %></p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Price</h3>
              <p class="mt-1 text-gray-900 dark:text-white">
                <% if @event.is_free? %>
                  Free
                <% else %>
                  <%= @event.price %> <%= @event.currency %>
                <% end %>
              </p>
            </div>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Event Type</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= @event.is_online? ? "Online" : "In-person" %></p>
            </div>
            
            <% if @event.is_online? && @event.online_url.present? %>
              <div>
                <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Online URL</h3>
                <p class="mt-1 text-gray-900 dark:text-white"><%= link_to @event.online_url, @event.online_url, target: "_blank", class: "text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" %></p>
              </div>
            <% end %>
            
            <div>
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Contact Email</h3>
              <p class="mt-1 text-gray-900 dark:text-white"><%= mail_to @event.contact_email, @event.contact_email, class: "text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" %></p>
            </div>
            
            <% if @event.contact_phone.present? %>
              <div>
                <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">Contact Phone</h3>
                <p class="mt-1 text-gray-900 dark:text-white"><%= @event.contact_phone %></p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Attendees -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Attendees (<%= @event.attendances.count %>)</h2>
          <% if @event.attendances.count > 10 %>
            <%= link_to "#", class: "text-sm text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" do %>
              View All <i class="fas fa-arrow-right ml-1"></i>
            <% end %>
          <% end %>
        </div>
        
        <% if @attendees.any? %>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
              <thead class="bg-gray-50 dark:bg-gray-700">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">User</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Registered At</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                </tr>
              </thead>
              <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                <% @attendees.each do |attendee| %>
                  <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="flex items-center">
                        <% if attendee.avatar.attached? %>
                          <%= image_tag attendee.avatar.variant(resize_to_fill: [40, 40]), class: "h-10 w-10 rounded-full mr-3 object-cover" %>
                        <% else %>
                          <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center mr-3">
                            <i class="fas fa-user text-indigo-500"></i>
                          </div>
                        <% end %>
                        <div>
                          <div class="text-sm font-medium text-gray-900 dark:text-white"><%= attendee.display_name %></div>
                          <div class="text-sm text-gray-500 dark:text-gray-400"><%= attendee.email %></div>
                        </div>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm text-gray-900 dark:text-white">
                        <%= attendee.attendances.find_by(event: @event).created_at.strftime("%B %d, %Y") %>
                      </div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">
                        <%= attendee.attendances.find_by(event: @event).created_at.strftime("%I:%M %p") %>
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                        Confirmed
                      </span>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% else %>
          <p class="text-gray-500 dark:text-gray-400">No attendees yet.</p>
        <% end %>
      </div>

      <!-- Comments -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Comments (<%= @event.event_comments.count %>)</h2>
          <% if @event.event_comments.count > 10 %>
            <%= link_to "#", class: "text-sm text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300" do %>
              View All <i class="fas fa-arrow-right ml-1"></i>
            <% end %>
          <% end %>
        </div>
        
        <% if @comments.any? %>
          <div class="space-y-4">
            <% @comments.each do |comment| %>
              <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div class="flex justify-between">
                  <div class="flex items-center">
                    <% if comment.user&.avatar&.attached? %>
                      <%= image_tag comment.user.avatar.variant(resize_to_fill: [40, 40]), class: "h-8 w-8 rounded-full mr-3 object-cover" %>
                    <% else %>
                      <div class="h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center mr-3">
                        <i class="fas fa-user text-indigo-500"></i>
                      </div>
                    <% end %>
                    <div>
                      <div class="text-sm font-medium text-gray-900 dark:text-white"><%= comment.user&.display_name || "Unknown User" %></div>
                      <div class="text-xs text-gray-500 dark:text-gray-400"><%= comment.created_at.strftime("%B %d, %Y at %I:%M %p") %></div>
                    </div>
                  </div>
                  <div>
                    <%= link_to "#", class: "text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300", data: { confirm: "Are you sure you want to delete this comment?" } do %>
                      <i class="fas fa-trash"></i>
                    <% end %>
                  </div>
                </div>
                <div class="mt-2 text-sm text-gray-700 dark:text-gray-300">
                  <%= comment.content %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-gray-500 dark:text-gray-400">No comments yet.</p>
        <% end %>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Event Status -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Event Status</h2>
        
        <div class="space-y-4">
          <div>
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Status</span>
              <% if @event.start_time > Time.current %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">Upcoming</span>
              <% elsif @event.end_time < Time.current %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Past</span>
              <% else %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ongoing</span>
              <% end %>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Featured</span>
              <% if @event.featured? %>
                <%= button_to admin_event_unfeature_path(@event), method: :post, class: "px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded-full text-xs font-semibold hover:bg-yellow-200 dark:hover:bg-yellow-800 transition-colors" do %>
                  Featured <i class="fas fa-star ml-1"></i>
                <% end %>
              <% else %>
                <%= button_to admin_event_feature_path(@event), method: :post, class: "px-2 py-1 bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 rounded-full text-xs font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" do %>
                  Not Featured <i class="far fa-star ml-1"></i>
                <% end %>
              <% end %>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Published</span>
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= @event.published? ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300' %>">
                <%= @event.published? ? "Published" : "Draft" %>
              </span>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Approved</span>
              <% if @event.approved? %>
                <%= button_to admin_event_reject_path(@event), method: :post, class: "px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full text-xs font-semibold hover:bg-green-200 dark:hover:bg-green-800 transition-colors" do %>
                  Approved <i class="fas fa-check ml-1"></i>
                <% end %>
              <% else %>
                <%= button_to admin_event_approve_path(@event), method: :post, class: "px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded-full text-xs font-semibold hover:bg-red-200 dark:hover:bg-red-800 transition-colors" do %>
                  Rejected <i class="fas fa-times ml-1"></i>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Organizer Info -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Organizer</h2>
        
        <% if @event.organizer %>
          <div class="flex items-center mb-4">
            <% if @event.organizer.avatar.attached? %>
              <%= image_tag @event.organizer.avatar.variant(resize_to_fill: [60, 60]), class: "h-12 w-12 rounded-full mr-4 object-cover" %>
            <% else %>
              <div class="h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center mr-4">
                <i class="fas fa-user text-indigo-500"></i>
              </div>
            <% end %>
            <div>
              <div class="text-md font-medium text-gray-900 dark:text-white"><%= @event.organizer.display_name %></div>
              <div class="text-sm text-gray-500 dark:text-gray-400"><%= @event.organizer.email %></div>
            </div>
          </div>
          
          <%= link_to admin_user_path(@event.organizer), class: "w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-center block" do %>
            View Organizer Profile
          <% end %>
        <% else %>
          <p class="text-gray-500 dark:text-gray-400">No organizer assigned.</p>
        <% end %>
      </div>

      <!-- Event Stats -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Event Stats</h2>
        
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Attendees</span>
            <span class="text-sm font-medium text-gray-900 dark:text-white"><%= @event.attendances.count %></span>
          </div>
          
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Comments</span>
            <span class="text-sm font-medium text-gray-900 dark:text-white"><%= @event.event_comments.count %></span>
          </div>
          
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Media Items</span>
            <span class="text-sm font-medium text-gray-900 dark:text-white"><%= @event.event_media.count %></span>
          </div>
          
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Created</span>
            <span class="text-sm font-medium text-gray-900 dark:text-white"><%= @event.created_at.strftime("%B %d, %Y") %></span>
          </div>
          
          <div class="flex justify-between items-center">
            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Last Updated</span>
            <span class="text-sm font-medium text-gray-900 dark:text-white"><%= @event.updated_at.strftime("%B %d, %Y") %></span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Actions</h2>
        
        <div class="space-y-3">
          <%= link_to edit_admin_event_path(@event), class: "w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-center block" do %>
            <i class="fas fa-edit mr-2"></i> Edit Event
          <% end %>
          
          <%= link_to admin_event_path(@event), method: :delete, data: { confirm: "Are you sure you want to delete this event?" }, class: "w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-center block" do %>
            <i class="fas fa-trash mr-2"></i> Delete Event
          <% end %>
          
          <%= link_to event_path(@event), target: "_blank", class: "w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-center block" do %>
            <i class="fas fa-external-link-alt mr-2"></i> View Public Page
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

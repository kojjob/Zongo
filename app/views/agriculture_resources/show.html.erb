<%# Agriculture Resource Detail Page %>
<% content_for :title, @resource.title %>

<!-- Main Content -->
<div class="container mx-auto px-4 py-8">
  <div class="mb-6">
    <a href="<%= resources_agriculture_path %>" class="inline-flex items-center text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300">
      <%= icon "arrow-left", class: "w-4 h-4 mr-2" %>
      Back to Resources
    </a>
  </div>
  
  <div class="flex flex-col lg:flex-row gap-8">
    <!-- Main Content -->
    <div class="w-full lg:w-2/3">
      <!-- Resource Content -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-100 dark:border-gray-700 mb-8">
        <!-- Header Image -->
        <% if @resource.thumbnail.attached? %>
          <div class="h-80 overflow-hidden">
            <%= image_tag @resource.thumbnail, class: "w-full h-full object-cover" %>
          </div>
        <% end %>
        
        <!-- Content -->
        <div class="p-8">
          <div class="flex items-center justify-between mb-6">
            <div>
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300 mb-2">
                <%= @resource.resource_type.titleize %>
              </span>
              <h1 class="text-3xl font-bold text-gray-900 dark:text-white"><%= @resource.title %></h1>
            </div>
            
            <div class="text-right">
              <div class="text-sm text-gray-500 dark:text-gray-400">
                <%= @resource.published_at&.strftime("%B %d, %Y") || @resource.created_at.strftime("%B %d, %Y") %>
              </div>
              <div class="flex items-center justify-end mt-1 text-sm text-gray-500 dark:text-gray-400">
                <%= icon "eye", class: "w-4 h-4 mr-1" %>
                <%= @resource.view_count %> views
              </div>
            </div>
          </div>
          
          <% if @resource.crop.present? %>
            <div class="flex items-center mb-6">
              <% if @resource.crop.image.attached? %>
                <%= image_tag @resource.crop.image, class: "w-10 h-10 rounded-full object-cover mr-3" %>
              <% else %>
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-white mr-3">
                  <%= icon "plant", class: "w-5 h-5" %>
                </div>
              <% end %>
              
              <div>
                <div class="text-sm text-gray-500 dark:text-gray-400">Related Crop</div>
                <a href="<%= crop_prices_agriculture_path(crop_id: @resource.crop.id) %>" class="text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 font-medium">
                  <%= @resource.crop.name %>
                </a>
              </div>
            </div>
          <% end %>
          
          <% if @resource.tag_list.present? %>
            <div class="flex flex-wrap gap-2 mb-6">
              <% @resource.tag_list.each do |tag| %>
                <a href="<%= resources_agriculture_path(query: tag) %>" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200">
                  <%= tag %>
                </a>
              <% end %>
            </div>
          <% end %>
          
          <!-- Main Content -->
          <div class="prose prose-emerald dark:prose-invert max-w-none">
            <%= simple_format(@resource.content) %>
          </div>
          
          <% if @resource.external_url.present? %>
            <div class="mt-8 p-4 bg-emerald-50 dark:bg-emerald-900/10 rounded-lg border border-emerald-200 dark:border-emerald-800/30">
              <div class="flex items-start">
                <%= icon "external-link", class: "w-5 h-5 text-emerald-500 dark:text-emerald-400 mt-0.5 mr-3 flex-shrink-0" %>
                <div>
                  <h3 class="font-medium text-gray-900 dark:text-white mb-1">External Resource</h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                    For more information, visit the external resource:
                  </p>
                  <a href="<%= @resource.external_url %>" target="_blank" rel="noopener noreferrer" class="text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 font-medium break-all">
                    <%= @resource.external_url %>
                  </a>
                </div>
              </div>
            </div>
          <% end %>
          
          <% if @resource.video_url.present? %>
            <div class="mt-8">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Video Resource</h3>
              <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden">
                <iframe src="<%= @resource.video_url.gsub('watch?v=', 'embed/') if @resource.video_url.include?('youtube.com') %>" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe>
              </div>
            </div>
          <% end %>
          
          <% if @resource.document.attached? %>
            <div class="mt-8 p-4 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-200 dark:border-blue-800/30">
              <div class="flex items-start">
                <%= icon "file-text", class: "w-5 h-5 text-blue-500 dark:text-blue-400 mt-0.5 mr-3 flex-shrink-0" %>
                <div>
                  <h3 class="font-medium text-gray-900 dark:text-white mb-1">Downloadable Resource</h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                    Download the attached document for more detailed information:
                  </p>
                  <a href="<%= url_for(@resource.document) %>" download class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-300">
                    <%= icon "download", class: "w-4 h-4 mr-2" %>
                    Download Document
                  </a>
                </div>
              </div>
            </div>
          <% end %>
          
          <% if @resource.images.attached? && @resource.images.count > 0 %>
            <div class="mt-8">
              <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Image Gallery</h3>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <% @resource.images.each do |image| %>
                  <div class="aspect-w-1 aspect-h-1 rounded-lg overflow-hidden">
                    <%= image_tag image, class: "w-full h-full object-cover" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
          
          <!-- Author Info -->
          <% if @resource.user.present? %>
            <div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
              <div class="flex items-center">
                <% if @resource.user.respond_to?(:avatar) && @resource.user.avatar.attached? %>
                  <%= image_tag @resource.user.avatar, class: "w-12 h-12 rounded-full object-cover mr-4" %>
                <% else %>
                  <div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-white mr-4">
                    <%= icon "user", class: "w-6 h-6" %>
                  </div>
                <% end %>
                
                <div>
                  <div class="font-medium text-gray-900 dark:text-white">
                    <%= @resource.user.respond_to?(:username) ? @resource.user.username : (@resource.user[:username] || @resource.user[:name] || 'Author') %>
                  </div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">
                    <% if @resource.user.respond_to?(:admin?) && @resource.user.admin? %>
                      Agricultural Expert
                    <% else %>
                      Contributor
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      
      <!-- Related Resources -->
      <% if @related_resources.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-100 dark:border-gray-700 mb-8">
          <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Related Resources</h2>
          </div>
          
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <% @related_resources.each do |resource| %>
                <a href="<%= agriculture_resource_path(resource) %>" class="block bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-xl border border-emerald-100 dark:border-emerald-800/30 p-4 hover:shadow-md transition-all duration-300">
                  <div class="flex items-start">
                    <div class="flex-shrink-0">
                      <div class="w-10 h-10 rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center text-emerald-600 dark:text-emerald-400">
                        <%= icon resource.resource_type == 'article' ? 'document-text' : (resource.resource_type == 'video' ? 'video-camera' : 'book-open'), class: "w-5 h-5" %>
                      </div>
                    </div>
                    <div class="ml-3">
                      <h3 class="text-sm font-medium text-gray-900 dark:text-white"><%= resource.title %></h3>
                      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400"><%= resource.reading_time %> min read â€¢ <%= resource.view_count %> views</p>
                    </div>
                  </div>
                </a>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
      
      <!-- Similar Resources -->
      <% if @similar_resources.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-100 dark:border-gray-700">
          <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">More <%= @resource.resource_type.titleize.pluralize %></h2>
          </div>
          
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <% @similar_resources.each do |resource| %>
                <a href="<%= agriculture_resource_path(resource) %>" class="block bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-300">
                  <% if resource.thumbnail.attached? %>
                    <div class="h-40 overflow-hidden rounded-t-xl">
                      <%= image_tag resource.thumbnail, class: "w-full h-full object-cover" %>
                    </div>
                  <% else %>
                    <div class="h-40 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-t-xl flex items-center justify-center">
                      <%= icon resource.resource_type == 'article' ? 'document-text' : (resource.resource_type == 'video' ? 'video-camera' : 'book-open'), class: "w-12 h-12 text-gray-400 dark:text-gray-500" %>
                    </div>
                  <% end %>
                  
                  <div class="p-4">
                    <h3 class="font-medium text-gray-900 dark:text-white mb-1 line-clamp-2"><%= resource.title %></h3>
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-500 dark:text-gray-400"><%= resource.reading_time %> min read</span>
                      <span class="text-xs text-emerald-600 dark:text-emerald-400">Read More</span>
                    </div>
                  </div>
                </a>
              <% end %>
            </div>
            
            <div class="mt-6 text-center">
              <a href="<%= resources_agriculture_path(resource_type: @resource.resource_type) %>" class="inline-flex items-center px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-300">
                View All <%= @resource.resource_type.titleize.pluralize %>
                <%= icon "arrow-right", class: "w-4 h-4 ml-2" %>
              </a>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    
    <!-- Sidebar -->
    <div class="w-full lg:w-1/3">
      <!-- Resource Info Card -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-100 dark:border-gray-700 mb-8 sticky top-24">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-bold text-gray-900 dark:text-white">Resource Information</h2>
        </div>
        
        <div class="p-6">
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-gray-700 dark:text-gray-300">Resource Type:</span>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300">
                <%= @resource.resource_type.titleize %>
              </span>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-gray-700 dark:text-gray-300">Reading Time:</span>
              <span class="text-gray-900 dark:text-white"><%= @resource.reading_time %> minutes</span>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-gray-700 dark:text-gray-300">Published:</span>
              <span class="text-gray-900 dark:text-white">
                <%= @resource.published_at&.strftime("%B %d, %Y") || @resource.created_at.strftime("%B %d, %Y") %>
              </span>
            </div>
            
            <% if @resource.crop.present? %>
              <div class="flex items-center justify-between">
                <span class="text-gray-700 dark:text-gray-300">Related Crop:</span>
                <a href="<%= crop_prices_agriculture_path(crop_id: @resource.crop.id) %>" class="text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300">
                  <%= @resource.crop.name %>
                </a>
              </div>
            <% end %>
            
            <div class="flex items-center justify-between">
              <span class="text-gray-700 dark:text-gray-300">Views:</span>
              <span class="text-gray-900 dark:text-white"><%= @resource.view_count %></span>
            </div>
          </div>
          
          <% if @resource.crop.present? %>
            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
              <h3 class="font-medium text-gray-900 dark:text-white mb-3">About <%= @resource.crop.name %></h3>
              
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                <%= @resource.crop.description.truncate(150) %>
              </p>
              
              <a href="<%= crop_prices_agriculture_path(crop_id: @resource.crop.id) %>" class="inline-flex items-center text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 text-sm font-medium">
                <span>View Crop Details</span>
                <%= icon "arrow-right", class: "w-4 h-4 ml-1" %>
              </a>
            </div>
          <% end %>
          
          <% if @resource.tag_list.present? %>
            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
              <h3 class="font-medium text-gray-900 dark:text-white mb-3">Tags</h3>
              
              <div class="flex flex-wrap gap-2">
                <% @resource.tag_list.each do |tag| %>
                  <a href="<%= resources_agriculture_path(query: tag) %>" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200">
                    <%= tag %>
                  </a>
                <% end %>
              </div>
            </div>
          <% end %>
          
          <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
            <h3 class="font-medium text-gray-900 dark:text-white mb-3">Share This Resource</h3>
            
            <div class="flex space-x-3">
              <a href="https://www.facebook.com/sharer/sharer.php?u=<%= request.original_url %>" target="_blank" rel="noopener noreferrer" class="w-10 h-10 rounded-full bg-blue-600 hover:bg-blue-700 flex items-center justify-center text-white transition-colors duration-300">
                <%= icon "facebook", class: "w-5 h-5" %>
              </a>
              
              <a href="https://twitter.com/intent/tweet?url=<%= request.original_url %>&text=<%= @resource.title %>" target="_blank" rel="noopener noreferrer" class="w-10 h-10 rounded-full bg-sky-500 hover:bg-sky-600 flex items-center justify-center text-white transition-colors duration-300">
                <%= icon "twitter", class: "w-5 h-5" %>
              </a>
              
              <a href="https://wa.me/?text=<%= @resource.title %>%20<%= request.original_url %>" target="_blank" rel="noopener noreferrer" class="w-10 h-10 rounded-full bg-green-600 hover:bg-green-700 flex items-center justify-center text-white transition-colors duration-300">
                <%= icon "whatsapp", class: "w-5 h-5" %>
              </a>
              
              <a href="mailto:?subject=<%= @resource.title %>&body=Check out this resource: <%= request.original_url %>" class="w-10 h-10 rounded-full bg-gray-600 hover:bg-gray-700 flex items-center justify-center text-white transition-colors duration-300">
                <%= icon "mail", class: "w-5 h-5" %>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
